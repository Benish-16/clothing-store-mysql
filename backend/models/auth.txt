

DELIMITER $$

CREATE PROCEDURE login_user(
    IN p_email VARCHAR(255),
    IN p_password VARCHAR(255)
)
BEGIN
    DECLARE v_user_id INT;
    DECLARE v_name VARCHAR(100);
    DECLARE v_is_admin BOOLEAN;

   
    SELECT user_id, name, is_admin
    INTO v_user_id, v_name, v_is_admin
    FROM users
    WHERE email = p_email AND password = SHA2(p_password, 256)
    LIMIT 1;


    IF v_user_id IS NULL THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Invalid email or password';
    END IF;


    SELECT v_user_id AS user_id, v_name AS name, p_email AS email, v_is_admin AS is_admin;
END$$

DELIMITER ;
